name: Update JSONs

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create plugins.json
        run: |
          cat > plugins.json << 'JSONEOF'
[
  {
    "name": "AnimesOnlineCC",
    "internalName": "AnimesOnlineCC",
    "description": "Assista animes online gratis em HD no AnimesOnlineCC",
    "version": 10,
    "authors": ["franciscoalro"],
    "repositoryUrl": "https://github.com/franciscoalro/TestPlugins",
    "status": 1,
    "language": "pt-BR",
    "tvTypes": ["Anime", "OVA", "AnimeMovie"],
    "iconUrl": "https://animesonlinecc.to/wp-content/uploads/2020/01/cropped-favicon-32x32.png",
    "apiVersion": 1,
    "isAdult": false,
    "fileSize": 15000,
    "url": "https://github.com/franciscoalro/TestPlugins/releases/download/v10/AnimesOnlineCC.cs3"
  },
  {
    "name": "MaxSeries",
    "internalName": "MaxSeries",
    "description": "MaxSeries v256 - PlayerEmbedAPI V8+V7 Fixes",
    "version": 256,
    "authors": ["franciscoalro"],
    "repositoryUrl": "https://github.com/franciscoalro/TestPlugins",
    "status": 1,
    "language": "pt-BR",
    "tvTypes": ["TvSeries", "Movie"],
    "iconUrl": "https://www.maxseries.pics/wp-content/themes/dooplay/assets/img/favicon.png",
    "apiVersion": 1,
    "isAdult": false,
    "fileSize": 653163,
    "url": "https://github.com/franciscoalro/TestPlugins/releases/download/v256/MaxSeries.cs3",
    "fileHash": "541781E424BC37EF2ECC5F0AB6B1FAB402AC1B3F564232D634526CB9993CC105",
    "updatedAt": "2026-01-31 18:53:57"
  }
]
JSONEOF
          
      - name: Create repo.json
        run: |
          cat > repo.json << 'JSONEOF'
{
  "name": "Francisco Plugins",
  "description": "Repositorio pessoal de extensoes",
  "manifestVersion": 1,
  "pluginLists": ["https://franciscoalro.github.io/CloudstreamRepo/plugins.json"]
}
JSONEOF
          
      - name: Verify JSONs
        run: |
          node -e "JSON.parse(require('fs').readFileSync('plugins.json')); console.log('plugins.json OK')"
          node -e "JSON.parse(require('fs').readFileSync('repo.json')); console.log('repo.json OK')"
          
      - name: Commit changes
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add plugins.json repo.json
          if ! git diff --cached --quiet; then
            git commit -m "Update JSONs via Actions - $(date -u +%Y%m%d_%H%M%S)"
            git push
          fi
